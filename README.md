## Тестовое задание в Сбер
Цель - реализация библиотеки для автоматического построения ML-модели и выбор оптимальной модели/ансамбля моделей на основе переданной метрики.
Библиотека реализуется на базе opensource-библиотеки [auto-sklearn](https://automl.github.io/auto-sklearn/master/index.html).
Auto-sklearn автоматически строит многочисленные комбинации предобработчиков и классификаторов из библиотеки sklearn, и, используя Байесовскую оптимизацию, находит оптимальные модели и объединяет их в ансамбль.
Написанный класс позволяет реализовать описанную выше логику на основе передаваемого датасета и метрики.

## Как запустить и использовать библиотеку
К сожалению, auto-sklearn работает только под Linux. Запустить на Windows код, использующий эту библиотеку, невозможно, на MacOS проверить работоспособность мне не удалось - нет устройства с MacOS.

Поэтому рассмотрим два кейса - запуск из-под Linux, и запуск в Docker.

### Запуск из-под Linux
При работе на ОС Linux, можно работать с кодом как с обычной библиотекой - импортировать класс и взаимодействовать с ним объявленными методами.
Пример работы с библиотекой показан в файле showcase.py. Чтобы запустить все, нужно проделать следующие шаги:
0. Клонируем репозиторий и переходим в директорию SberTest
1. (Опционально) создаем virtualenv в этой директории ```python3 -m venv venv-name``` и активируем её ```source venv-name/bin/activate```
2. Устанавливаем зависимости командой ```pip install -r requirments.txt```
3. Код готов к запуску, можно запустить showcase.py или импортировать библиотеку и написать какой-то свой скрипт.

### Запуск в Docker.
При работе под Windows или MacOS, можно запустить код в Docker. Для этого подготовлен Dockerfile, запускающий код, написанный в файле showcase.py
Запуск в Docker реализуется следующими командами:

0. Клонируем репозиторий и переходим в директорию SberTest
1. Создаем образ: ```docker build -t automl . ```. Можно использовать для удобства Makefile, и использовать команду ```make build```.
2. Запускаем образ ```docker run automl``` или ```make run```.
3. Можно вносить изменения в файл showcase.py, и перезапускать, выполняя шаги 1 и 2.

### Подробности о классе:
1. __init__ принимает на вход обязательный аргумент **metric** - это строка, в которой содержится название метрики, на её основе происходит выбор модели и оптимизация ансамбля.
Если передана неподдерживаемая метрика, будет брошено исключение WrongMetricError, в котором перечислены возможные метрики. Так же их можно посмотреть в METRICS из файла automl/metrics.py
Опциональные **kwargs передаются, чтобы прокинуть аргументы для инициализации класса auto-sklearn внутри.
В showcase передаются аргументы:
   1. **time_left_for_this_task=120** - ограничивает общее время поиска оптимальной архитектуры переданным кол-вом секунд. Чем больше время, тем более "качественная" архитектура может быть найдена, для демо просто передается две минуты.
   2. **per_run_time_limit=30** - ограничивает время на одну итерацию поиска,
   3. **memory_limit=None** - снимает ограничение по используемой памяти (можно задать кол-во мегабайт).
2. fit принимает на вход датасет, его разметку, бьет его на обучающую и тестовую выборку, обучает и находит оптимальную архитектуру, тестирует ее. Принимает опционально:
   1. **split_kwargs** - опциональные аргументы для дробления датасета на test/train выборки,
   2. **fit_kwargs** - опциональные аргументы для функции fit класса auto-sklearn.
3. predict принимает на вход выборку, выполняет классификацию и возвращает результат,
4. score возвращает значение переданной метрики ансамбля после обучения на тестовой выборке,
5. leaderboard возвращает таблицу моделей с их индивидуальной точностью и весами в ансамбле,
6. ensemble возвращает подробное описание самого ансамбля.